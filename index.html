<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Expense Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
        }
        
        /* Login Screen */
        #login-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: white;
        }
        
        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2575fc;
            margin-bottom: 10px;
        }
        
        .app-subtitle {
            color: #666;
            margin-bottom: 40px;
        }
        
        .login-form {
            width: 100%;
            max-width: 400px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #2575fc;
            box-shadow: 0 0 0 2px rgba(37, 117, 252, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2575fc;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1c64e0;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        /* Main App */
        #app-screen {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
        }
        
        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: #2575fc;
            color: white;
        }
        
        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6a11cb;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
        }
        
        /* Main Content */
        .app-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #f8f9fa;
            padding: 20px 0;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        
        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #555;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #e9ecef;
            color: #2575fc;
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #2575fc;
            font-weight: 600;
        }
        
        /* Dashboard */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .recent-expenses {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .expense-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .expense-table th, .expense-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .expense-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        /* Category Settings */
        .category-list {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .category-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .category-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-icon {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn-icon:hover {
            color: #2575fc;
        }
        
        .btn-icon.btn-edit {
            color: #2575fc;
        }
        .btn-icon.btn-edit:hover {
            color: #1c64e0;
        }
        .btn-icon.btn-delete {
            color: #dc3545;
        }
        .btn-icon.btn-delete:hover {
            color: #c82333;
        }

        .btn-icon.btn-pay {
            color: #28a745;
        }
        .btn-icon.btn-pay:hover {
            color: #218838;
        }

        .add-category-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* Expenses */
        .expense-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .overdue-expense {
            background-color: #fff2f2 !important;
            font-weight: 500;
        }
        .overdue-expense:hover {
            background-color: #ffe8e8 !important;
        }

        .expense-filters .form-group {
            min-width: 180px;
        }
        
        .add-expense-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        /* Reports */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            height: 300px;
            position: relative;
        }
        
        .report-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .report-filters .form-group {
            min-width: 180px;
        }
        
        /* Settings */
        .settings-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .settings-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #2575fc;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .save-settings {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .app-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                padding: 0;
            }
            
            .nav-item {
                padding: 15px;
                flex-direction: column;
                gap: 5px;
                font-size: 0.8rem;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .expense-filters, .report-filters {
                flex-direction: column;
            }
            
            .settings-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .save-settings {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-screen">
            <h1 class="app-title">Home Expense Tracker</h1>
            <p class="app-subtitle">Track your expenses with ease</p>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" value="qabalamurali@outlook.com">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" value="Sanjay@2014">
                </div>
                
                <button class="btn btn-primary" onclick="login()">Login</button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p>Don't have an account? <a href="#" style="color: #2575fc; text-decoration: none;">Sign up</a></p>
                </div>
            </div>
        </div>
        
        <!-- Main Application -->
        <div id="app-screen">
            <!-- Header -->
            <div class="app-header">
                <div class="header-left">
                    <h1 title="Home Expense Tracker">Home Expense Tracker</h1>
                    <div id="current-datetime" style="font-size: 0.85rem; opacity: 0.9;"></div>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar">BP</div>
                        <span>Balamurali P</span>
                    </div>
                    <button class="btn-icon" style="color: white;" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="app-content">
                <!-- Sidebar -->
                <div class="sidebar">
                    <a class="nav-item active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a class="nav-item" data-section="expenses">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Expenses</span>
                    </a>
                    <a class="nav-item" data-section="upcoming-expenses">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Upcoming Expenses</span>
                    </a>
                    <a class="nav-item" data-section="categories">
                        <i class="fas fa-tags"></i>
                        <span>Categories</span>
                    </a>
                    <a class="nav-item" data-section="reports">
                        <i class="fas fa-chart-pie"></i>
                        <span>Reports</span>
                    </a>
                    <a class="nav-item" data-section="settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
                
                <!-- Content Area -->
                <div class="content-area">
                    <!-- Dashboard Section -->
                    <div class="section active" id="dashboard">
                        <h2 class="section-title">Dashboard</h2>
                        
                        <div class="stats-cards">
                            <div class="stat-card">
                                <span class="stat-label">Total Spent This Month</span>
                                <span class="stat-value" id="month-total">$0.00</span>
                                <span class="stat-change" id="month-comparison">Loading...</span>
                            </div>
                            
                            <div class="stat-card">
                                <span class="stat-label">Remaining Budget</span>
                                <span class="stat-value" id="remaining-budget">$0.00</span>
                                <span class="stat-change" id="budget-status">No budget set</span>
                            </div>
                            
                            <div class="stat-card">
                                <span class="stat-label">Top Category</span>
                                <span class="stat-value" id="top-category">None</span>
                                <span class="stat-change" id="top-category-amount">No expenses</span>
                            </div>
                        </div>
                        
                        <div class="recent-expenses">
                            <h3>Recent Expenses</h3>
                            <table class="expense-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-expenses-list">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Expenses Section -->
                    <div class="section" id="expenses">
                        <h2 class="section-title">Expense Management</h2>
                        
                        <div class="expense-filters">
                            <div class="form-group">
                                <label for="filter-month">Month</label>
                                <select id="filter-month" class="form-control">
                                    <option value="">All Months</option>
                                    <!-- Months will be populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="filter-category">Category</label>
                                <select id="filter-category" class="form-control">
                                    <option value="">All Categories</option>
                                    <!-- Categories will be populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="filter-amount">Amount Range</label>
                                <select id="filter-amount" class="form-control">
                                    <option value="">Any Amount</option>
                                    <option value="0-50">$0 - $50</option>
                                    <option value="50-100">$50 - $100</option>
                                    <option value="100-500">$100 - $500</option>
                                    <option value="500+">$500+</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" style="align-self: flex-end;" onclick="filterExpenses()">Apply Filters</button>
                        </div>
                        
                        <div class="add-expense-form">
                            <h3>Add New Expense</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expense-date">Date</label>
                                    <input type="date" id="expense-date" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expense-category">Category</label>
                                    <select id="expense-category" class="form-control">
                                        <!-- Categories will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expense-description">Description</label>
                                    <input type="text" id="expense-description" class="form-control" placeholder="Enter expense description">
                                </div>
                                
                                <div class="form-group">
                                    <label for="expense-amount">Amount (<span id="currency-symbol">$</span>)</label>
                                    <input type="number" id="expense-amount" class="form-control" placeholder="0.00" step="0.01" min="0">
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="addExpense()">Add Expense</button>
                        </div>
                        
                        <div class="recent-expenses">
                            <h3>All Expenses</h3>
                            <table class="expense-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="all-expenses-list">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Upcoming Expenses Section -->
                    <div class="section" id="upcoming-expenses">
                        <h2 class="section-title">Upcoming & Recurring Expenses</h2>

                        <div class="add-expense-form">
                            <h3>Add Upcoming/Recurring Expense</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="upcoming-description">Description</label>
                                    <input type="text" id="upcoming-description" class="form-control" placeholder="e.g., Rent, Netflix Subscription">
                                </div>
                                <div class="form-group">
                                    <label for="upcoming-amount">Amount (<span id="upcoming-currency-symbol">$</span>)</label>
                                    <input type="number" id="upcoming-amount" class="form-control" placeholder="0.00" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="upcoming-category">Category</label>
                                    <select id="upcoming-category" class="form-control">
                                        <!-- Categories will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="upcoming-due-date">Next Due Date</label>
                                    <input type="date" id="upcoming-due-date" class="form-control">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="upcoming-recurrence">Recurrence</label>
                                    <select id="upcoming-recurrence" class="form-control">
                                        <option value="none">None (One-time)</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly" selected>Monthly</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="addUpcomingExpense()">Add Upcoming Expense</button>
                        </div>

                        <div class="recent-expenses">
                            <h3>Scheduled Expenses</h3>
                            <table class="expense-table">
                                <thead>
                                    <tr>
                                        <th>Next Due Date</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Recurrence</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="upcoming-expenses-list">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Categories Section -->
                    <div class="section" id="categories">
                        <h2 class="section-title">Category Settings</h2>
                        
                        <div class="category-list">
                            <h3>Existing Categories</h3>
                            <div id="categories-list">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="add-category-form">
                            <h3>Add New Category</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="category-name">Category Name</label>
                                    <input type="text" id="category-name" placeholder="Enter category name">
                                </div>
                                
                                <div class="form-group">
                                    <label for="category-color">Color</label>
                                    <input type="color" id="category-color" value="#6a11cb">
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="addCategory()">Add Category</button>
                        </div>
                    </div>
                    
                    <!-- Reports Section -->
                    <div class="section" id="reports">
                        <h2 class="section-title">Expense Reports</h2>
                        
                        <div class="report-filters">
                            <div class="form-group">
                                <label for="report-period">Period</label>
                                <select id="report-period" class="form-control">
                                    <option value="this_week">This Week</option>
                                    <option value="last_week">Last Week</option>
                                    <option value="this_month" selected>This Month</option>
                                    <option value="last_month">Last Month</option>
                                    <option value="90">Last 90 Days</option>
                                    <option value="this_year">This Year</option>
                                    <option value="last_year">Last Year</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="report-type">Report Type</label>
                                <select id="report-type" class="form-control">
                                    <option value="category" selected>By Category</option>
                                    <option value="time">By Time</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" style="align-self: flex-end;" onclick="generateReport()">Generate Report</button>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="report-chart"></canvas>
                        </div>
                        
                        <div class="recent-expenses">
                            <h3>Detailed Report</h3>
                            <table class="expense-table">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody id="report-details">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                                <tfoot id="report-footer">
                                    <!-- Total will be populated by JavaScript -->
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="section" id="settings">
                        <h2 class="section-title">Settings</h2>
                        
                        <div class="settings-panel">
                            <div class="settings-item">
                                <div>
                                    <h4>Monthly Budget</h4>
                                    <p>Set a monthly spending limit</p>
                                </div>
                                <input type="number" id="monthly-budget" placeholder="0.00" step="0.01" min="0" class="form-control" style="width: 120px;">
                            </div>
                            
                            <div class="settings-item">
                                <div>
                                    <h4>Currency</h4>
                                    <p>Select your preferred currency</p>
                                </div>
                                <select id="currency" class="form-control">
                                    <option value="$">USD ($)</option>
                                    <option value="€">EUR (€)</option>
                                    <option value="£">GBP (£)</option>
                                    <option value="¥">JPY (¥)</option>
                                    <option value="₹">INR (₹)</option>
                                </select>
                            </div>
                            
                            <div class="settings-item">
                                <div>
                                    <h4>Dark Mode</h4>
                                    <p>Switch to dark theme</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dark-mode">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="settings-item">
                                <div>
                                    <h4>Export Data</h4>
                                    <p>Download your expense data as CSV</p>
                                </div>
                                <button class="btn btn-primary" onclick="exportData()">Export</button>
                            </div>
                            
                            <div class="settings-item">
                                <div>
                                    <h4>Reset Data</h4>
                                    <p>Clear all expenses and categories</p>
                                </div>
                                <button class="btn btn-primary" style="background: #dc3545;" onclick="confirmReset()">Reset</button>
                            </div>
                        </div>
                        
                        <div class="save-settings">
                            <button class="btn btn-success" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Expense Modal -->
    <div class="modal" id="edit-expense-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Expense</h3>
                <span class="close-modal" onclick="closeModal('edit-expense-modal')">&times;</span>
            </div>
            
            <div class="form-group">
                <label for="edit-expense-date">Date</label>
                <input type="date" id="edit-expense-date" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="edit-expense-category">Category</label>
                <select id="edit-expense-category" class="form-control">
                    <!-- Categories will be populated by JavaScript -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="edit-expense-description">Description</label>
                <input type="text" id="edit-expense-description" class="form-control" placeholder="Enter expense description">
            </div>
            
            <div class="form-group">
                <label for="edit-expense-amount">Amount (<span id="edit-currency-symbol">$</span>)</label>
                <input type="number" id="edit-expense-amount" class="form-control" placeholder="0.00" step="0.01" min="0">
            </div>
            
            <input type="hidden" id="edit-expense-id">
            
            <button class="btn btn-primary" onclick="updateExpense()">Update Expense</button>
        </div>
    </div>

    <!-- Edit Upcoming Expense Modal -->
    <div class="modal" id="edit-upcoming-expense-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Upcoming Expense</h3>
                <span class="close-modal" onclick="closeModal('edit-upcoming-expense-modal')">&times;</span>
            </div>
            
            <div class="form-group">
                <label for="edit-upcoming-description">Description</label>
                <input type="text" id="edit-upcoming-description" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit-upcoming-amount">Amount (<span id="edit-upcoming-currency-symbol">$</span>)</label>
                <input type="number" id="edit-upcoming-amount" class="form-control" step="0.01" min="0">
            </div>
            <div class="form-group">
                <label for="edit-upcoming-category">Category</label>
                <select id="edit-upcoming-category" class="form-control"></select>
            </div>
            <div class="form-group">
                <label for="edit-upcoming-due-date">Next Due Date</label>
                <input type="date" id="edit-upcoming-due-date" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit-upcoming-recurrence">Recurrence</label>
                <select id="edit-upcoming-recurrence" class="form-control">
                    <option value="none">None (One-time)</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
            </div>
            
            <input type="hidden" id="edit-upcoming-expense-id">
            
            <button class="btn btn-primary" onclick="updateUpcomingExpense()">Update Expense</button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <span class="close-modal" onclick="closeModal('confirm-modal')">&times;</span>
            </div>
            
            <p id="confirm-message">Are you sure you want to proceed?</p>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn" style="background: #6c757d; color: white;" onclick="closeModal('confirm-modal')">Cancel</button>
                <button class="btn" style="background: #dc3545; color: white;" id="confirm-button">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let upcomingExpenses = JSON.parse(localStorage.getItem('upcomingExpenses')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            { id: 1, name: 'Groceries', color: '#4CAF50' },
            { id: 2, name: 'Utilities', color: '#2196F3' },
            { id: 3, name: 'Entertainment', color: '#FF9800' },
            { id: 4, name: 'Dining', color: '#F44336' },
            { id: 5, name: 'Transport', color: '#9C27B0' }
        ];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            monthlyBudget: 0,
            currency: '$',
            darkMode: false
        };
        
        // Initialize chart variable
        let expenseChart = null;

        // To hold the interval for date-time update
        let dateTimeInterval = null;
        
        // Initialize application
        function initApp() {
            // Load settings
            if (settings.monthlyBudget) {
                document.getElementById('monthly-budget').value = settings.monthlyBudget;
            }
            document.getElementById('currency').value = settings.currency;
            document.getElementById('dark-mode').checked = settings.darkMode;
            
            // Update currency symbols
            updateCurrencySymbols();
            
            // Populate category dropdowns
            populateCategoryDropdowns();
            
            // Populate months dropdown
            populateMonthsDropdown();
            
            // Load expenses
            loadExpenses();
            
            // Load categories
            loadCategories();

            // Load upcoming expenses
            loadUpcomingExpenses();
            
            // Update dashboard
            updateDashboard();
            
            // Generate initial report
            generateReport();

            // Start date/time display and update every second
            if (!dateTimeInterval) {
                updateDateTime();
                dateTimeInterval = setInterval(updateDateTime, 1000);
            }
        }
        
        // Update currency symbols across the UI
        function updateCurrencySymbols() {
            const currencySymbol = settings.currency;
            document.getElementById('currency-symbol').textContent = currencySymbol;
            document.getElementById('edit-currency-symbol').textContent = currencySymbol;
            document.getElementById('upcoming-currency-symbol').textContent = currencySymbol;
            document.getElementById('edit-upcoming-currency-symbol').textContent = currencySymbol;
            
            // Update amount filter options
            const amountFilter = document.getElementById('filter-amount');
            if (amountFilter) {
                amountFilter.innerHTML = `
                    <option value="">Any Amount</option>
                    <option value="0-50">${currencySymbol}0 - ${currencySymbol}50</option>
                    <option value="50-100">${currencySymbol}50 - ${currencySymbol}100</option>
                    <option value="100-500">${currencySymbol}100 - ${currencySymbol}500</option>
                    <option value="500+">${currencySymbol}500+</option>
                `;
            }
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'flex';
                initApp();
            } else {
                alert('Please enter both username and password');
            }
        }
        
        // Logout function
        function logout() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app-screen').style.display = 'none';

            // Stop the date-time update
            if (dateTimeInterval) {
                clearInterval(dateTimeInterval);
                dateTimeInterval = null;
            }
        }
        
        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all items
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show the selected section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // If reports section, generate report
                if (sectionId === 'reports') {
                    generateReport();
                }
            });
        });

        // Function to update date and time
        function updateDateTime() {
            const dateTimeElement = document.getElementById('current-datetime');
            if (dateTimeElement) {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };
                dateTimeElement.textContent = now.toLocaleString('en-US', options);
            }
        }


        
        // Populate category dropdowns
        function populateCategoryDropdowns() {
            const categorySelects = [
                document.getElementById('expense-category'),
                document.getElementById('filter-category'),
                document.getElementById('edit-expense-category'),
                document.getElementById('upcoming-category'),
                document.getElementById('edit-upcoming-category')
            ];
            
            categorySelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Select Category</option>';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
                }
            });
        }
        
        // Populate months dropdown
        function populateMonthsDropdown() {
            const monthSelect = document.getElementById('filter-month');
            if (!monthSelect) return;
            
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            
            // Get unique months from expenses
            const expenseMonths = [...new Set(expenses.map(expense => {
                const date = new Date(expense.date);
                return `${date.getFullYear()}-${date.getMonth()}`;
            }))];
            
            expenseMonths.forEach(monthKey => {
                const [year, month] = monthKey.split('-');
                const option = document.createElement('option');
                option.value = monthKey;
                option.textContent = `${months[parseInt(month)]} ${year}`;
                monthSelect.appendChild(option);
            });
        }
        
        // Add expense
        function addExpense() {
            const date = document.getElementById('expense-date').value;
            const categoryId = document.getElementById('expense-category').value;
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if (!date || !categoryId || !description || isNaN(amount) || amount <= 0) {
                alert('Please fill all fields with valid values');
                return;
            }
            
            const newExpense = {
                id: Date.now(),
                date,
                categoryId: parseInt(categoryId),
                description,
                amount
            };
            
            expenses.push(newExpense);
            saveExpenses();
            loadExpenses();
            updateDashboard();
            
            // Clear form
            document.getElementById('expense-date').value = '';
            document.getElementById('expense-category').value = '';
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
        }
        
        // Load expenses
        function loadExpenses() {
            const allExpensesList = document.getElementById('all-expenses-list');
            const recentExpensesList = document.getElementById('recent-expenses-list');
            
            if (!allExpensesList || !recentExpensesList) return;
            
            // Filter expenses based on filters
            const monthFilter = document.getElementById('filter-month').value;
            const categoryFilter = document.getElementById('filter-category').value;
            const amountFilter = document.getElementById('filter-amount').value;
            
            let filteredExpenses = [...expenses];
            
            if (monthFilter) {
                const [year, month] = monthFilter.split('-');
                filteredExpenses = filteredExpenses.filter(expense => {
                    const expenseDate = new Date(expense.date);
                    return expenseDate.getFullYear() === parseInt(year) && 
                           expenseDate.getMonth() === parseInt(month);
                });
            }
            
            if (categoryFilter) {
                filteredExpenses = filteredExpenses.filter(expense => 
                    expense.categoryId === parseInt(categoryFilter)
                );
            }
            
            if (amountFilter) {
                if (amountFilter === '0-50') {
                    filteredExpenses = filteredExpenses.filter(expense => expense.amount <= 50);
                } else if (amountFilter === '50-100') {
                    filteredExpenses = filteredExpenses.filter(expense => 
                        expense.amount > 50 && expense.amount <= 100
                    );
                } else if (amountFilter === '100-500') {
                    filteredExpenses = filteredExpenses.filter(expense => 
                        expense.amount > 100 && expense.amount <= 500
                    );
                } else if (amountFilter === '500+') {
                    filteredExpenses = filteredExpenses.filter(expense => expense.amount > 500);
                }
            }
            
            // Sort by date (newest first)
            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Display all expenses
            allExpensesList.innerHTML = '';
            filteredExpenses.forEach(expense => {
                const category = categories.find(c => c.id === expense.categoryId);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td><span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: ${category?.color || '#999'}"></span> ${category?.name || 'Uncategorized'}</td>
                    <td>${expense.description}</td>
                    <td>${settings.currency}${expense.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn-icon btn-edit" title="Edit" onclick="editExpense(${expense.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn-icon btn-delete" title="Delete" onclick="deleteExpense(${expense.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                allExpensesList.appendChild(row);
            });
            
            // Display recent expenses (last 5)
            recentExpensesList.innerHTML = '';
            const recentExpenses = [...expenses]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            recentExpenses.forEach(expense => {
                const category = categories.find(c => c.id === expense.categoryId);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td><span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: ${category?.color || '#999'}"></span> ${category?.name || 'Uncategorized'}</td>
                    <td>${expense.description}</td>
                    <td>${settings.currency}${expense.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn-icon btn-edit" title="Edit" onclick="editExpense(${expense.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn-icon btn-delete" title="Delete" onclick="deleteExpense(${expense.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                recentExpensesList.appendChild(row);
            });
        }
        
        // Filter expenses
        function filterExpenses() {
            loadExpenses();
        }
        
        // Edit expense
        function editExpense(id) {
            const expense = expenses.find(e => e.id === id);
            if (!expense) return;
            
            document.getElementById('edit-expense-id').value = expense.id;
            document.getElementById('edit-expense-date').value = expense.date;
            document.getElementById('edit-expense-category').value = expense.categoryId;
            document.getElementById('edit-expense-description').value = expense.description;
            document.getElementById('edit-expense-amount').value = expense.amount;
            
            openModal('edit-expense-modal');
        }
        
        // Update expense
        function updateExpense() {
            const id = parseInt(document.getElementById('edit-expense-id').value);
            const date = document.getElementById('edit-expense-date').value;
            const categoryId = document.getElementById('edit-expense-category').value;
            const description = document.getElementById('edit-expense-description').value;
            const amount = parseFloat(document.getElementById('edit-expense-amount').value);
            
            if (!date || !categoryId || !description || isNaN(amount) || amount <= 0) {
                alert('Please fill all fields with valid values');
                return;
            }
            
            const index = expenses.findIndex(e => e.id === id);
            if (index === -1) return;
            
            expenses[index] = {
                id,
                date,
                categoryId: parseInt(categoryId),
                description,
                amount
            };
            
            saveExpenses();
            loadExpenses();
            updateDashboard();
            closeModal('edit-expense-modal');
            
            // If on reports section, regenerate report
            if (document.getElementById('reports').classList.contains('active')) {
                generateReport();
            }
        }
        
        // Delete expense
        function deleteExpense(id) {
            showConfirmation('Are you sure you want to delete this expense?', () => {
                expenses = expenses.filter(e => e.id !== id);
                saveExpenses();
                loadExpenses();
                updateDashboard();
                
                // If on reports section, regenerate report
                if (document.getElementById('reports').classList.contains('active')) {
                    generateReport();
                }
            });
        }
        
        // Add upcoming expense
        function addUpcomingExpense() {
            const description = document.getElementById('upcoming-description').value;
            const amount = parseFloat(document.getElementById('upcoming-amount').value);
            const categoryId = document.getElementById('upcoming-category').value;
            const dueDate = document.getElementById('upcoming-due-date').value;
            const recurrence = document.getElementById('upcoming-recurrence').value;

            if (!description || isNaN(amount) || amount <= 0 || !categoryId || !dueDate) {
                alert('Please fill all fields with valid values');
                return;
            }

            const newUpcomingExpense = {
                id: Date.now(),
                description,
                amount,
                categoryId: parseInt(categoryId),
                dueDate,
                recurrence
            };

            upcomingExpenses.push(newUpcomingExpense);
            saveUpcomingExpenses();
            loadUpcomingExpenses();

            // Clear form
            document.getElementById('upcoming-description').value = '';
            document.getElementById('upcoming-amount').value = '';
            document.getElementById('upcoming-category').value = '';
            document.getElementById('upcoming-due-date').value = '';
            document.getElementById('upcoming-recurrence').value = 'monthly';
        }

        // Load upcoming expenses
        function loadUpcomingExpenses() {
            const list = document.getElementById('upcoming-expenses-list');
            if (!list) return;

            list.innerHTML = '';
            const today = new Date(new Date().setHours(0, 0, 0, 0));

            upcomingExpenses.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

            upcomingExpenses.forEach(ue => {
                const category = categories.find(c => c.id === ue.categoryId);
                const row = document.createElement('tr');
                
                const dueDate = new Date(ue.dueDate);
                if (dueDate < today) {
                    row.classList.add('overdue-expense');
                }

                row.innerHTML = `
                    <td>${formatDate(ue.dueDate)}</td>
                    <td>${ue.description}</td>
                    <td><span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: ${category?.color || '#999'}"></span> ${category?.name || 'Uncategorized'}</td>
                    <td>${settings.currency}${ue.amount.toFixed(2)}</td>
                    <td>${ue.recurrence.charAt(0).toUpperCase() + ue.recurrence.slice(1)}</td>
                    <td>
                        <button class="btn-icon btn-pay" title="Mark as Paid" onclick="payUpcomingExpense(${ue.id})"><i class="fas fa-check-circle"></i></button>
                        <button class="btn-icon btn-edit" title="Edit" onclick="editUpcomingExpense(${ue.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn-icon btn-delete" title="Delete" onclick="deleteUpcomingExpense(${ue.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                list.appendChild(row);
            });
        }

        // Pay upcoming expense
        function payUpcomingExpense(id) {
            const index = upcomingExpenses.findIndex(ue => ue.id === id);
            if (index === -1) return;

            const upcoming = upcomingExpenses[index];

            // 1. Add to regular expenses
            const newExpense = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0], // Today's date
                categoryId: upcoming.categoryId,
                description: upcoming.description,
                amount: upcoming.amount
            };
            expenses.push(newExpense);
            saveExpenses();

            // 2. Update or delete the upcoming expense
            if (upcoming.recurrence === 'none') {
                upcomingExpenses.splice(index, 1);
            } else {
                const [year, month, day] = upcoming.dueDate.split('-').map(Number);
                let nextDueDate = new Date(year, month - 1, day);

                switch (upcoming.recurrence) {
                    case 'weekly': nextDueDate.setDate(nextDueDate.getDate() + 7); break;
                    case 'monthly': nextDueDate.setMonth(nextDueDate.getMonth() + 1); break;
                    case 'yearly': nextDueDate.setFullYear(nextDueDate.getFullYear() + 1); break;
                }
                upcoming.dueDate = nextDueDate.toISOString().split('T')[0];
            }

            saveUpcomingExpenses();

            // 3. Refresh UI
            loadExpenses();
            loadUpcomingExpenses();
            updateDashboard();
            alert('Expense paid and recorded!');
        }

        // Edit upcoming expense
        function editUpcomingExpense(id) {
            const expense = upcomingExpenses.find(e => e.id === id);
            if (!expense) return;

            document.getElementById('edit-upcoming-expense-id').value = expense.id;
            document.getElementById('edit-upcoming-description').value = expense.description;
            document.getElementById('edit-upcoming-amount').value = expense.amount;
            document.getElementById('edit-upcoming-category').value = expense.categoryId;
            document.getElementById('edit-upcoming-due-date').value = expense.date;
            document.getElementById('edit-upcoming-recurrence').value = expense.recurrence;
            
            openModal('edit-upcoming-expense-modal');
        }

        // Add category
        function addCategory() {
            const name = document.getElementById('category-name').value;
            const color = document.getElementById('category-color').value;
            
            if (!name) {
                alert('Please enter a category name');
                return;
            }
            
            const newCategory = {
                id: Date.now(),
                name,
                color
            };
            
            categories.push(newCategory);
            saveCategories();
            loadCategories();
            populateCategoryDropdowns();
            
            // Clear form
            document.getElementById('category-name').value = '';
            document.getElementById('category-color').value = '#6a11cb';
        }
        
        // Load categories
        function loadCategories() {
            const categoriesList = document.getElementById('categories-list');
            if (!categoriesList) return;
            
            categoriesList.innerHTML = '';
            
            categories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'category-item';
                
                item.innerHTML = `
                    <div class="category-info">
                        <div class="category-color" style="background-color: ${category.color};"></div>
                        <span>${category.name}</span>
                    </div>
                    <div class="category-actions">
                        <button class="btn-icon btn-edit" title="Edit" onclick="editCategory(${category.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn-icon btn-delete" title="Delete" onclick="deleteCategory(${category.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                categoriesList.appendChild(item);
            });
        }
        
        // Edit category (placeholder)
        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            const newName = prompt('Enter new category name:', category.name);
            if (newName && newName.trim() !== '') {
                category.name = newName.trim();
                saveCategories();
                loadCategories();
                populateCategoryDropdowns();
            }
        }
        
        // Delete category
        function deleteCategory(id) {
            // Check if category is used in expenses
            const isUsed = expenses.some(expense => expense.categoryId === id);
            
            if (isUsed) {
                alert('This category is used in expenses and cannot be deleted.');
                return;
            }
            
            showConfirmation('Are you sure you want to delete this category?', () => {
                categories = categories.filter(c => c.id !== id);
                saveCategories();
                loadCategories();
                populateCategoryDropdowns();
            });
        }
        
        // Update upcoming expense
        function updateUpcomingExpense() {
            const id = parseInt(document.getElementById('edit-upcoming-expense-id').value);
            const description = document.getElementById('edit-upcoming-description').value;
            const amount = parseFloat(document.getElementById('edit-upcoming-amount').value);
            const categoryId = document.getElementById('edit-upcoming-category').value;
            const dueDate = document.getElementById('edit-upcoming-due-date').value;
            const recurrence = document.getElementById('edit-upcoming-recurrence').value;

            if (!description || isNaN(amount) || amount <= 0 || !categoryId || !dueDate) {
                alert('Please fill all fields with valid values');
                return;
            }

            const index = upcomingExpenses.findIndex(e => e.id === id);
            if (index === -1) return;

            upcomingExpenses[index] = { id, description, amount, categoryId: parseInt(categoryId), dueDate, recurrence };
            
            saveUpcomingExpenses();
            loadUpcomingExpenses();
            closeModal('edit-upcoming-expense-modal');
        }

        // Delete upcoming expense
        function deleteUpcomingExpense(id) {
            showConfirmation('Are you sure you want to delete this upcoming expense?', () => {
                upcomingExpenses = upcomingExpenses.filter(e => e.id !== id);
                saveUpcomingExpenses();
                loadUpcomingExpenses();
            });
        }

        // Generate report
        function generateReport() {
            const period = document.getElementById('report-period').value;
            const reportType = document.getElementById('report-type').value;
            
            // Calculate date range
            const now = new Date();
            let startDate, endDate;
            endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999); // End of today

            if (!isNaN(period)) { // Handles '90'
                startDate = new Date();
                startDate.setDate(startDate.getDate() - parseInt(period));
                startDate.setHours(0, 0, 0, 0);
            } else {
                const today = now.getDay(); // 0=Sunday, 1=Monday, ...
                switch (period) {
                    case 'this_week':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - today);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'last_week':
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - today - 1);
                        endDate.setHours(23, 59, 59, 999);
                        startDate = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'this_month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'last_month':
                        endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                        endDate.setHours(23, 59, 59, 999);
                        startDate = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'this_year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'last_year':
                        endDate = new Date(now.getFullYear() - 1, 11, 31);
                        endDate.setHours(23, 59, 59, 999);
                        startDate = new Date(now.getFullYear() - 1, 0, 1);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                }
            }
            
            // Filter expenses by date range
            const filteredExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                // Adjust for timezone offset to compare dates correctly
                const adjustedExpenseDate = new Date(expenseDate.getTime() + expenseDate.getTimezoneOffset() * 60000);
                return adjustedExpenseDate >= startDate && adjustedExpenseDate <= endDate;
            });
            
            if (reportType === 'category') {
                generateCategoryReport(filteredExpenses);
            } else {
                generateTimeReport(filteredExpenses, startDate, endDate);
            }
        }
        
        // Generate category report
        function generateCategoryReport(expenses) {
            const reportDetails = document.getElementById('report-details');
            const reportFooter = document.getElementById('report-footer');
            reportDetails.innerHTML = '';
            reportFooter.innerHTML = '';

            // Calculate total
            const total = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            // Group by category
            const categoryTotals = {};
            expenses.forEach(expense => {
                const categoryId = expense.categoryId;
                if (!categoryTotals[categoryId]) {
                    categoryTotals[categoryId] = 0;
                }
                categoryTotals[categoryId] += expense.amount;
            });
            
            // Prepare data for chart
            const chartLabels = [];
            const chartData = [];
            const chartColors = [];
            
            // Add rows for each category
            for (const categoryId in categoryTotals) {
                const category = categories.find(c => c.id === parseInt(categoryId));
                const amount = categoryTotals[categoryId];
                const percentage = total > 0 ? (amount / total * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: ${category?.color || '#999'}"></span> ${category?.name || 'Uncategorized'}</td>
                    <td>${settings.currency}${amount.toFixed(2)}</td>
                    <td>${percentage}%</td>
                `;
                
                reportDetails.appendChild(row);
                
                // Add to chart data
                chartLabels.push(category?.name || 'Uncategorized');
                chartData.push(amount);
                chartColors.push(category?.color || '#999');
            }
            
            // Add total to footer
            if (expenses.length > 0) {
                const footerRow = document.createElement('tr');
                footerRow.style.fontWeight = 'bold';
                footerRow.style.backgroundColor = '#f8f9fa';
                footerRow.innerHTML = `
                    <td>Total</td>
                    <td>${settings.currency}${total.toFixed(2)}</td>
                    <td></td>
                `;
                reportFooter.appendChild(footerRow);
            }

            // Create chart
            const ctx = document.getElementById('report-chart').getContext('2d');
            
            // Destroy previous chart if exists
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            expenseChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Amount',
                        data: chartData,
                        backgroundColor: chartColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // Makes it a horizontal bar chart
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Expenses by Category - Total: ${settings.currency}${total.toFixed(2)}`,
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: `Amount (${settings.currency})`
                            }
                        }
                    }
                }
            });
        }
        
        // Generate time report (placeholder)
        function generateTimeReport(expenses, startDate, endDate) {
            const reportDetails = document.getElementById('report-details');
            const reportFooter = document.getElementById('report-footer');
            reportDetails.innerHTML = '<tr><td colspan="3" style="text-align: center;">Time-based reports are a work in progress.</td></tr>';
            reportFooter.innerHTML = '';

            // Calculate total for the period
            const total = expenses.reduce((sum, expense) => sum + expense.amount, 0);

            // Add total to footer
            if (expenses.length > 0) {
                const footerRow = document.createElement('tr');
                footerRow.style.fontWeight = 'bold';
                footerRow.style.backgroundColor = '#f8f9fa';
                footerRow.innerHTML = `
                    <td>Total</td>
                    <td>${settings.currency}${total.toFixed(2)}</td>
                    <td></td>
                `;
                reportFooter.appendChild(footerRow);
            }

            // Create chart
            const ctx = document.getElementById('report-chart').getContext('2d');
            
            // Destroy previous chart if exists
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            expenseChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Expenses',
                        data: [65, 59, 80, 81, 56, 55],
                        backgroundColor: '#2575fc',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Expenses Over Time - Total: ${settings.currency}${total.toFixed(2)}`,
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }
        
        // Update dashboard
        function updateDashboard() {
            // Calculate current month total
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && 
                       expenseDate.getFullYear() === currentYear;
            });
            
            const monthTotal = monthExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            document.getElementById('month-total').textContent = `${settings.currency}${monthTotal.toFixed(2)}`;
            
            // Calculate previous month total for comparison
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            const prevMonthExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === prevMonth && 
                       expenseDate.getFullYear() === prevYear;
            });
            
            const prevMonthTotal = prevMonthExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            let comparisonText = 'No previous data';
            if (prevMonthTotal > 0) {
                const change = ((monthTotal - prevMonthTotal) / prevMonthTotal * 100).toFixed(1);
                comparisonText = `${change >= 0 ? '+' : ''}${change}% from last month`;
            }
            
            document.getElementById('month-comparison').textContent = comparisonText;
            
            // Update budget status
            const monthlyBudget = settings.monthlyBudget || 0;
            const remaining = monthlyBudget - monthTotal;
            
            document.getElementById('remaining-budget').textContent = `${settings.currency}${Math.max(0, remaining).toFixed(2)}`;
            
            let budgetStatus = 'No budget set';
            if (monthlyBudget > 0) {
                const percentage = (monthTotal / monthlyBudget * 100).toFixed(1);
                budgetStatus = `${percentage}% of budget used`;
                
                if (remaining < 0) {
                    budgetStatus = `Over budget by ${settings.currency}${Math.abs(remaining).toFixed(2)}`;
                }
            }
            
            document.getElementById('budget-status').textContent = budgetStatus;
            
            // Find top category
            if (monthExpenses.length > 0) {
                const categoryTotals = {};
                monthExpenses.forEach(expense => {
                    const categoryId = expense.categoryId;
                    if (!categoryTotals[categoryId]) {
                        categoryTotals[categoryId] = 0;
                    }
                    categoryTotals[categoryId] += expense.amount;
                });
                
                let topCategoryId = null;
                let topCategoryAmount = 0;
                
                for (const categoryId in categoryTotals) {
                    if (categoryTotals[categoryId] > topCategoryAmount) {
                        topCategoryAmount = categoryTotals[categoryId];
                        topCategoryId = parseInt(categoryId);
                    }
                }
                
                const topCategory = categories.find(c => c.id === topCategoryId);
                document.getElementById('top-category').textContent = topCategory?.name || 'Uncategorized';
                document.getElementById('top-category-amount').textContent = `${settings.currency}${topCategoryAmount.toFixed(2)} spent`;
            } else {
                document.getElementById('top-category').textContent = 'None';
                document.getElementById('top-category-amount').textContent = 'No expenses';
            }
        }
        
        // Save settings
        function saveSettings() {
            settings.monthlyBudget = parseFloat(document.getElementById('monthly-budget').value) || 0;
            settings.currency = document.getElementById('currency').value;
            settings.darkMode = document.getElementById('dark-mode').checked;
            
            localStorage.setItem('settings', JSON.stringify(settings));
            
            // Update currency symbols across the UI
            updateCurrencySymbols();
            
            // Refresh all displays to show new currency
            updateDashboard();
            loadExpenses();
            
            if (document.getElementById('reports').classList.contains('active')) {
                generateReport();
            }
            
            alert('Settings saved successfully!');
        }
        
        // Export data
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({
                expenses,
                categories,
                settings
            }));
            
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "expense_data.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
        
        // Confirm reset
        function confirmReset() {
            showConfirmation('Are you sure you want to reset all data? This cannot be undone.', () => {
                upcomingExpenses = [];
                expenses = [];
                categories = [
                    { id: 1, name: 'Groceries', color: '#4CAF50' },
                    { id: 2, name: 'Utilities', color: '#2196F3' },
                    { id: 3, name: 'Entertainment', color: '#FF9800' },
                    { id: 4, name: 'Dining', color: '#F44336' },
                    { id: 5, name: 'Transport', color: '#9C27B0' }
                ];
                settings = {
                    monthlyBudget: 0,
                    currency: '$',
                    darkMode: false
                };
                
                saveUpcomingExpenses();
                saveExpenses();
                saveCategories();
                localStorage.setItem('settings', JSON.stringify(settings));
                
                // Update UI
                document.getElementById('monthly-budget').value = '';
                document.getElementById('currency').value = '$';
                document.getElementById('dark-mode').checked = false;
                
                // Update currency symbols
                updateCurrencySymbols();
                
                loadExpenses();
                loadCategories();
                loadUpcomingExpenses();
                populateCategoryDropdowns();
                updateDashboard();
                
                if (document.getElementById('reports').classList.contains('active')) {
                    generateReport();
                }
            });
        }
        
        // Save expenses to localStorage
        function saveExpenses() {
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }
        
        // Save upcoming expenses to localStorage
        function saveUpcomingExpenses() {
            localStorage.setItem('upcomingExpenses', JSON.stringify(upcomingExpenses));
        }

        // Save categories to localStorage
        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Show confirmation dialog
        function showConfirmation(message, confirmCallback) {
            document.getElementById('confirm-message').textContent = message;
            const confirmButton = document.getElementById('confirm-button');
            
            // Remove any existing event listeners
            const newConfirmButton = confirmButton.cloneNode(true);
            confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
            
            // Add new event listener
            newConfirmButton.addEventListener('click', () => {
                confirmCallback();
                closeModal('confirm-modal');
            });
            
            openModal('confirm-modal');
        }
        
        // Set default date to today
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expense-date').value = today;
            
            const upcomingDate = document.getElementById('upcoming-due-date');
            if(upcomingDate) upcomingDate.value = today;

        };
    </script>
</body>
</html>